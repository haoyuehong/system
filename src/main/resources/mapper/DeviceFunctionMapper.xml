<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="system.dao.DeviceFunctionMapper">
  <resultMap id="BaseResultMap" type="system.model.DeviceFunction">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="device_code" jdbcType="VARCHAR" property="deviceCode" />
    <result column="real_num" jdbcType="INTEGER" property="realNum" />
    <result column="hstory_num" jdbcType="INTEGER" property="hstoryNum" />
    <result column="cur_num" jdbcType="INTEGER" property="curNum" />
    <result column="on_time" jdbcType="TIMESTAMP" property="onTime" />
    <result column="this_duration" jdbcType="INTEGER" property="thisDuration" />
    <result column="total_duration" jdbcType="INTEGER" property="totalDuration" />
    <result column="last_upload_time" jdbcType="TIMESTAMP" property="lastUploadTime" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, device_code, real_num, hstory_num, cur_num, on_time, this_duration, total_duration, 
    last_upload_time
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from device_function
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from device_function
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="system.model.DeviceFunction">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into device_function (id, device_code, real_num, 
      hstory_num, cur_num, on_time, 
      this_duration, total_duration, last_upload_time
      )
    values (#{id,jdbcType=INTEGER}, #{deviceCode,jdbcType=VARCHAR}, #{realNum,jdbcType=INTEGER}, 
      #{hstoryNum,jdbcType=INTEGER}, #{curNum,jdbcType=INTEGER}, #{onTime,jdbcType=TIMESTAMP}, 
      #{thisDuration,jdbcType=INTEGER}, #{totalDuration,jdbcType=INTEGER}, #{lastUploadTime,jdbcType=TIMESTAMP}
      )
  </insert>
  <insert id="insertSelective" parameterType="system.model.DeviceFunction">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into device_function
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="deviceCode != null">
        device_code,
      </if>
      <if test="realNum != null">
        real_num,
      </if>
      <if test="hstoryNum != null">
        hstory_num,
      </if>
      <if test="curNum != null">
        cur_num,
      </if>
      <if test="onTime != null">
        on_time,
      </if>
      <if test="thisDuration != null">
        this_duration,
      </if>
      <if test="totalDuration != null">
        total_duration,
      </if>
      <if test="lastUploadTime != null">
        last_upload_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="deviceCode != null">
        #{deviceCode,jdbcType=VARCHAR},
      </if>
      <if test="realNum != null">
        #{realNum,jdbcType=INTEGER},
      </if>
      <if test="hstoryNum != null">
        #{hstoryNum,jdbcType=INTEGER},
      </if>
      <if test="curNum != null">
        #{curNum,jdbcType=INTEGER},
      </if>
      <if test="onTime != null">
        #{onTime,jdbcType=TIMESTAMP},
      </if>
      <if test="thisDuration != null">
        #{thisDuration,jdbcType=INTEGER},
      </if>
      <if test="totalDuration != null">
        #{totalDuration,jdbcType=INTEGER},
      </if>
      <if test="lastUploadTime != null">
        #{lastUploadTime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="system.model.DeviceFunction">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update device_function
    <set>
      <if test="deviceCode != null">
        device_code = #{deviceCode,jdbcType=VARCHAR},
      </if>
      <if test="realNum != null">
        real_num = #{realNum,jdbcType=INTEGER},
      </if>
      <if test="hstoryNum != null">
        hstory_num = #{hstoryNum,jdbcType=INTEGER},
      </if>
      <if test="curNum != null">
        cur_num = #{curNum,jdbcType=INTEGER},
      </if>
      <if test="onTime != null">
        on_time = #{onTime,jdbcType=TIMESTAMP},
      </if>
      <if test="thisDuration != null">
        this_duration = #{thisDuration,jdbcType=INTEGER},
      </if>
      <if test="totalDuration != null">
        total_duration = #{totalDuration,jdbcType=INTEGER},
      </if>
      <if test="lastUploadTime != null">
        last_upload_time = #{lastUploadTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="system.model.DeviceFunction">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update device_function
    set device_code = #{deviceCode,jdbcType=VARCHAR},
      real_num = #{realNum,jdbcType=INTEGER},
      hstory_num = #{hstoryNum,jdbcType=INTEGER},
      cur_num = #{curNum,jdbcType=INTEGER},
      on_time = #{onTime,jdbcType=TIMESTAMP},
      this_duration = #{thisDuration,jdbcType=INTEGER},
      total_duration = #{totalDuration,jdbcType=INTEGER},
      last_upload_time = #{lastUploadTime,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=INTEGER}
  </update>

  <!--根据设备码查询设备运行情况-->
  <select id="findByDeviceCode" resultType="system.dto.DeviceFunctionVO">
    SELECT d.device_name AS  deviceName, d.device_address AS deviceAddress,
           d.build_time AS buildTime,df.real_num AS realNum, df.hstory_num AS hstoryNum,
           df.cur_num AS curNum,df.on_time AS onTime,df.this_duration AS thisDuration,
           df.total_duration AS totalDuration, df.last_upload_time AS lastUploadTime,
           d.device_image AS deviceImage, d.device_status AS deviceStatus
    FROM device_function df, device d
    WHERE df.device_code = d.device_code AND d.device_code = #{deviceCode}
    ORDER BY  totalDuration DESC,hstoryNum DESC
  </select>


  <!--根据设备码查询设备运行情况-->
  <select id="findFunctionBaseByDeviceCode" resultType="system.dto.DeviceFunctionBase">
    SELECT d.device_name AS  deviceName, df.hstory_num AS hstoryNum,
    df.total_duration AS totalDuration
    FROM device_function df, device d
    WHERE df.device_code = d.device_code AND d.device_code = #{deviceCode}
    ORDER BY  totalDuration DESC,hstoryNum DESC
  </select>

  <!--根据学校代码统计设备运行情况-->
  <select id="deviceFunctionCountBySchoolCode" resultType="system.dto.DeviceFunctionVO">
    SELECT  d.device_name AS  deviceName, df.hstory_num AS hstoryNum,
            df.total_duration AS totalDuration
    FROM device_function df, device d,school s
    WHERE df.device_code = d.device_code AND s.school_code = d.group_id AND s.school_code = #{groupId}
  </select>

</mapper>